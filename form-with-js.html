<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contact (JS Validation)</title>
  <link rel="stylesheet" href="main.css" />
  <style>
    .invalid-flash {
      animation: flash 0.3s;
    }

    @keyframes flash {
      0% { background-color: #fee2e2; }
      100% { background-color: inherit; }
    }

    .countdown-warning {
      color: #f59e0b;
    }

    .countdown-danger {
      color: #dc2626;
      font-weight: bold;
    }
  </style>
</head>
<body>
    <header style="position: relative;">
        <h1>Ayoob Al-Delaimy</h1>
        
        <button id="theme-toggle" aria-label="Toggle dark/light mode" style="position: absolute; top: 1rem; right: 1rem;">
          üåô Dark Mode
        </button>
      
        <nav>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="experiences.html">Experiences</a></li>
            <li><a href="projects.html">Projects</a></li>
            <li><a href="resume.html">Resume</a></li>
            <li><a href="form-with-js.html">Contact</a></li>
          </ul>
        </nav>
      </header>

  <main>
    <h2>Contact</h2>

    <form id="contactForm" action="https://httpbin.org/post" method="post" class="contact-form" novalidate>
      <input type="hidden" name="possible_bot" value="true" />
      <input type="hidden" name="form-errors" id="formErrorsField" value="" />

      <div class="form-group">
        <label for="name">Name <span>*</span></label>
        <input id="name" name="name" type="text" required minlength="2" maxlength="50" />
        <output class="error" name="error-name"></output>
        <output class="info" name="info-name"></output>
      </div>

      <div class="form-group">
        <label for="email">Email <span>*</span></label>
        <input id="email" name="email" type="email" required />
        <output class="error" name="error-email"></output>
        <output class="info" name="info-email"></output>
      </div>

      <div class="form-group">
        <label for="comments">Comments <span>*</span></label>
        <textarea id="comments" name="comments" rows="4" required minlength="10" maxlength="300"></textarea>
        <output class="error" name="error-comments"></output>
        <output class="info" name="info-comments"></output>
        <p id="charCount" aria-live="polite"></p>
      </div>

      <button type="submit">Submit</button>
    </form>
  </main>

  <footer></footer>

  <script>
const form = document.getElementById("contactForm");
const nameInput = document.getElementById("name");
const emailInput = document.getElementById("email");
const commentsInput = document.getElementById("comments");
const charCount = document.getElementById("charCount");
const formErrorsField = document.getElementById("formErrorsField");

let formErrors = [];

const showError = (field, message) => {
  const output = field.parentElement.querySelector(".error");
  output.textContent = message;
  field.classList.add("invalid-flash");
  setTimeout(() => {
    output.textContent = "";
    field.classList.remove("invalid-flash");
  }, 2000);
};

nameInput.addEventListener("beforeinput", (e) => {
  const char = e.data;
  if (char && !/^[a-zA-Z\s]$/.test(char)) {
    e.preventDefault();
    showError(nameInput, `Illegal character "${char}" blocked`);
    formErrors.push({
      field: "name",
      value: nameInput.value + char,
      error: `Illegal character "${char}" blocked`,
      type: "masking"
    });
  }
});

commentsInput.addEventListener("input", () => {
  const max = 300;
  const len = commentsInput.value.length;
  const remaining = max - len;

  charCount.textContent = `${remaining} characters remaining`;
  charCount.className = "";
  if (remaining <= 50) charCount.classList.add("countdown-warning");
  if (remaining <= 20) charCount.classList.add("countdown-danger");

  if (len > max) {
    showError(commentsInput, "Comment is too long.");
    formErrors.push({
      field: "comments",
      value: commentsInput.value,
      error: "Exceeded max character limit",
      type: "length"
    });
  }
});

form.addEventListener("submit", (e) => {
  let hasErrors = false;

  nameInput.setCustomValidity("");
  emailInput.setCustomValidity("");
  commentsInput.setCustomValidity("");

  const nameVal = nameInput.value.trim();
  const emailVal = emailInput.value.trim();
  const commentVal = commentsInput.value.trim();

  if (!/^[a-zA-Z\s]+$/.test(nameVal)) {
    nameInput.setCustomValidity("Only letters and spaces allowed.");
    showError(nameInput, "Only letters and spaces allowed.");
    formErrors.push({
      field: "name",
      value: nameVal,
      error: "Contains invalid characters",
      type: "validation"
    });
    hasErrors = true;
  }

  if (!emailInput.checkValidity()) {
    emailInput.setCustomValidity("Enter a valid email.");
    showError(emailInput, emailInput.validationMessage);
    formErrors.push({
      field: "email",
      value: emailVal,
      error: emailInput.validationMessage,
      type: "validation"
    });
    hasErrors = true;
  }

  if (!commentsInput.checkValidity()) {
    commentsInput.setCustomValidity("Comment must be 10‚Äì300 characters.");
    showError(commentsInput, commentsInput.validationMessage);
    formErrors.push({
      field: "comments",
      value: commentVal,
      error: commentsInput.validationMessage,
      type: "validation"
    });
    hasErrors = true;
  }

  formErrorsField.value = JSON.stringify(formErrors);

  if (hasErrors) {
    e.preventDefault();
  }
});

const toggleBtn = document.getElementById("theme-toggle");
    const savedTheme = localStorage.getItem("theme");
  
    if (savedTheme === "dark") {
      document.documentElement.classList.add("dark");
      toggleBtn.textContent = "‚òÄÔ∏è Light Mode";
    }
  
    toggleBtn?.addEventListener("click", () => {
      const isDark = document.documentElement.classList.toggle("dark");
      toggleBtn.textContent = isDark ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    }); 
  </script>
</body>
</html>
